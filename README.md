## å†™è„šæœ¬èµ·å› 
windowsçš„å°é¸¡é¢å¯¹æš´åŠ›ç ´è§£ï¼Œè®¾ç½®ç™½åå•æ˜¯ä¸ªå¥½åŠæ³•ï¼Œä½†æ˜¯åƒIPç»å¸¸å˜åŠ¨çš„å®¶åº­å®½å¸¦ï¼Œå°±ä¸å®ç”¨äº†ã€‚å› æ­¤è·Ÿchatgptå‹å¥½äº¤æµäº†ä¸€å¤©æ—¶é—´ï¼Œå†™å‡ºäº†ä¸ª`ç«¯å£æ•²é—¨ç»™ç‰¹å®šIPå¼€é—¨`çš„è„šæœ¬ã€‚

## åŸç†

åŸºäºç«¯å£æ•²é—¨ï¼Œé€šè¿‡ç›‘å¬ç‰¹å®šç«¯å£ï¼Œåªæœ‰æä¾›æ­£ç¡® UUID çš„å®¢æˆ·ç«¯æ‰èƒ½è®¿é—®æœåŠ¡å™¨è¿œç¨‹æ¡Œé¢ã€‚

## â˜… æ³¨æ„äº‹é¡¹ â˜…
å°é¸¡è£…å¥½windowsä»¥åï¼Œéƒ½æœ‰ä¸€æ¡è¿æ¥è¿œç¨‹æ¡Œé¢çš„é»˜è®¤è§„åˆ™ï¼ˆTCPï¼‰ï¼Œä¸è¦åˆ ï¼Œè®¾ç½®ç™½åå•ç»™ä¸€ä¸ªæˆ–æ›´å¤šè‡ªç”¨vpsçš„IPï¼ˆèƒ½è¿å°±è¡Œï¼‰ï¼Œè„šæœ¬å¤±æ•ˆï¼Œå¯ä»¥ç•™ä¸ªåè·¯ï¼Œä»¥é˜²è‡ªå·±è¿½æ‚”è«åŠã€‚å½“ç„¶å°é¸¡åå°VNCå¥½ç”¨çš„å¯ä»¥å¿½ç•¥è¿™æ¡

## æ–‡ä»¶è¯´æ˜

- `config.json` - é…ç½®æ–‡ä»¶
- `SetupTask.ps1` - åˆ›å»ºè®¡åˆ’ä»»åŠ¡å’Œå¼€æ”¾ç›‘å¬ç«¯å£çš„é˜²ç«å¢™è§„åˆ™
- `PortKnocker.ps1` - ä¸»è¦æ–‡ä»¶ã€ç›‘å¬ç«¯å£å¹¶åŠ¨æ€å¼€æ”¾ RDP è®¿é—®
- `RemoveFirewall.ps1` - ç§»é™¤è¿‡æœŸçš„é˜²ç«å¢™è§„åˆ™ï¼ˆé»˜è®¤å¸¦æ—¥å¿—ï¼‰
- `RemoveFirewall_NoLog.ps1` - ç§»é™¤è¿‡æœŸçš„é˜²ç«å¢™è§„åˆ™ï¼ˆä¸å¸¦æ—¥å¿—ï¼‰
---
- `knock.ps1` å®¢æˆ·ç«¯æ•²é—¨çš„è„šæœ¬

## ä½¿ç”¨æ–¹æ³•

1. **é…ç½®è¯´æ˜**

- `IP` - é»˜è®¤ä¸ºç©ºï¼Œå¼€æ”¾è¿œç¨‹æ¡Œé¢ç»™å®¢æˆ·ç«¯IPã€‚å¦‚æœè®¾ç½®äº†ï¼Œå°±åªå¼€æ”¾è¿œç¨‹æ¡Œé¢ç»™æ­¤IPã€‚
- `ListenPort` - ç›‘å¬ç«¯å£ï¼Œæ­¤ç«¯å£è¦ä¿æŒæŒç»­å¼€æ”¾
- `RDPPort` - è¿œç¨‹æ¡Œé¢ç«¯å£
- `AccessDuration` - å¼€æ”¾æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
- `UUID` - å®¢æˆ·ç«¯éœ€è¦å‘é€æ­¤çš„ UUID ä¿¡æ¯
- `TaskInterval` - æ ¹æ®è¿‡æœŸæ—¶é—´æ¯éš” n åˆ†é’Ÿæ¸…é™¤é˜²ç«å¢™è§„åˆ™
- `EnableLogging` - æ˜¯å¦éœ€è¦ç”Ÿæˆæ—¥å¿—
  
3. é…ç½®æ–‡ä»¶è®¾ç½®å¥½ä»¥åï¼Œè¿è¡Œ`SetupTask.ps1` è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆè§„åˆ™å’Œè®¡åˆ’ä»»åŠ¡
4. æŒç»­è¿è¡Œ PortKnocker.ps1ï¼ˆå¯æ³¨å†Œä¸ºæœåŠ¡ï¼‰

## ä½¿ç”¨ NSSM å°† PowerShell è„šæœ¬æ³¨å†Œä¸º Windows æœåŠ¡

### 1. ä¸‹è½½ NSSM
ä» [NSSM å®˜ç½‘](https://nssm.cc/) ä¸‹è½½ `nssm.exe`ï¼Œå¹¶è§£å‹åˆ°æŸä¸ªç›®å½•ï¼ˆå¦‚ `D:\nssm`ï¼‰ã€‚

### 2. å‡†å¤‡ PowerShell è„šæœ¬
å‡è®¾ä½ çš„ PowerShell è„šæœ¬è·¯å¾„ä¸ºï¼š`D:\portknock\PortKnocker.ps1`
å®ƒåŒ…å«ä½ å¸Œæœ›ä½œä¸ºæœåŠ¡è¿è¡Œçš„ä»£ç ã€‚

### 3. ä½¿ç”¨ NSSM æ³¨å†ŒæœåŠ¡
æ‰“å¼€PowerShell æˆ– CMD è¾“å…¥å‘½ä»¤ ï¼š

```cmd
cd /d D:\nssm

nssm install PortKnocker
```
ä¼šå¼¹å‡ºä¸€ä¸ª GUI çª—å£ï¼Œåœ¨ Application é€‰é¡¹å¡å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š

> Path: é€‰æ‹© powershell.exeï¼ˆé€šå¸¸åœ¨C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exeï¼‰ã€‚
> 
> Startup directory: é€‰æ‹©è„šæœ¬æ‰€åœ¨ç›®å½•ï¼Œå¦‚ D:\portknockã€‚
> 
> Arguments: æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š
> 
> -ExecutionPolicy Bypass -File D:\portknock\PortKnocker.ps1

åˆ‡æ¢ Details é€‰é¡¹å¡
> Display name: æ˜¾ç¤ºåç§° è¾“å…¥PortKnocker service
> 

> 
> Dsecription: æè¿°
> 
> Startup type ï¼šå¯åŠ¨ç±»å‹. Automatic -è‡ªåŠ¨

ç‚¹å‡» Install serviceã€‚


### 4. å¯åŠ¨æœåŠ¡
æ³¨å†Œå®Œæˆåï¼Œåœ¨ PowerShell ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š

```powershell
Start-Service PortKnocker
```
æˆ–è€…å¯ä»¥åœ¨`æœåŠ¡`é¢æ¿ä¸­æ‰‹åŠ¨å¯åŠ¨

è¿™æ ·ï¼Œä½ çš„ PowerShell è„šæœ¬å°±æˆåŠŸæ³¨å†Œä¸º Windows æœåŠ¡ï¼Œå¹¶èƒ½éš Windows è‡ªåŠ¨è¿è¡Œï¼ ğŸš€

### NSSM å¯ç”¨å‘½ä»¤
```powershell
å¸è½½æœåŠ¡ï¼š nssm remove MyPowerShellService confirm

å¯åŠ¨æœåŠ¡ï¼š nssm start <servicename>

åœæ­¢æœåŠ¡ï¼š nssm stop <servicename>

é‡å¯æœåŠ¡ï¼š nssm restart <servicename>

æš‚åœ/ç»§ç»­æœåŠ¡
nssm pause <servicename>
nssm continue <servicename>

æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼šnssm status <servicename>
```
å‚è€ƒï¼š [ä½¿ç”¨NSSMæ³¨å†ŒWindowsæœåŠ¡](https://www.cnblogs.com/lichu-lc/p/10263799.html)
